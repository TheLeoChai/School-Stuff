(function(e,t){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)})}else if(typeof exports!=="undefined"){var n=require("underscore");t(e,exports,n)}else{e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}})(this,function(e,t,n,r){var i=e.Backbone;var s=[];var o=s.push;var u=s.slice;var a=s.splice;t.VERSION="1.1.2";t.$=r;t.noConflict=function(){e.Backbone=i;return this};t.emulateHTTP=false;t.emulateJSON=false;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);r.push({callback:t,context:n,ctx:n||this});return this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this;var s=n.once(function(){i.off(e,s);t.apply(this,arguments)});s._callback=t;return this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r){this._events=void 0;return this}u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r){for(l=0,h=o.length;l<h;l++){s=o[l];if(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context){i.push(s)}}}if(!i.length)delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e];var r=this._events.all;if(n)h(n,t);if(r)h(r,arguments);return this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;if(!r&&typeof t==="object")r=this;if(e)(i={})[e._listenId]=e;for(var o in i){e=i[o];e.off(t,r,this);if(s||n.isEmpty(e._events))delete this._listeningTo[o]}return this}};var l=/\s+/;var c=function(e,t,n,r){if(!n)return true;if(typeof n==="object"){for(var i in n){e[t].apply(e,[i,n[i]].concat(r))}return false}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++){e[t].apply(e,[s[o]].concat(r))}return false}return true};var h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}};var p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={});var o=t._listenId||(t._listenId=n.uniqueId("l"));s[o]=t;if(!i&&typeof r==="object")i=this;t[e](r,i,this);return this}});f.bind=f.on;f.unbind=f.off;n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={});this.cid=n.uniqueId("c");this.attributes={};if(t.collection)this.collection=t.collection;if(t.parse)r=this.parse(r,t)||{};r=n.defaults({},r,n.result(this,"defaults"));this.set(r,t);this.changed={};this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;if(typeof e==="object"){s=e;r=t}else{(s={})[e]=t}r||(r={});if(!this._validate(s,r))return false;o=r.unset;a=r.silent;u=[];f=this._changing;this._changing=true;if(!f){this._previousAttributes=n.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in s)this.id=s[this.idAttribute];for(i in s){t=s[i];if(!n.isEqual(c[i],t))u.push(i);if(!n.isEqual(l[i],t)){this.changed[i]=t}else{delete this.changed[i]}o?delete c[i]:c[i]=t}if(!a){if(u.length)this._pending=r;for(var h=0,p=u.length;h<p;h++){this.trigger("change:"+u[h],this,c[u[h]],r)}}if(f)return this;if(!a){while(this._pending){r=this._pending;this._pending=false;this.trigger("change",this,r)}}this._pending=false;this._changing=false;return this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:true}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:true}))},hasChanged:function(e){if(e==null)return!n.isEmpty(this.changed);return n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):false;var t,r=false;var i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){if(e==null||!this._previousAttributes)return null;return this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{};if(e.parse===void 0)e.parse=true;var t=this;var r=e.success;e.success=function(n){if(!t.set(t.parse(n,e),e))return false;if(r)r(t,n,e);t.trigger("sync",t,n,e)};I(this,e);return this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;if(e==null||typeof e==="object"){i=e;r=t}else{(i={})[e]=t}r=n.extend({validate:true},r);if(i&&!r.wait){if(!this.set(i,r))return false}else{if(!this._validate(i,r))return false}if(i&&r.wait){this.attributes=n.extend({},u,i)}if(r.parse===void 0)r.parse=true;var a=this;var f=r.success;r.success=function(e){a.attributes=u;var t=a.parse(e,r);if(r.wait)t=n.extend(i||{},t);if(n.isObject(t)&&!a.set(t,r)){return false}if(f)f(a,e,r);a.trigger("sync",a,e,r)};I(this,r);s=this.isNew()?"create":r.patch?"patch":"update";if(s==="patch")r.attrs=i;o=this.sync(s,this,r);if(i&&r.wait)this.attributes=u;return o},destroy:function(e){e=e?n.clone(e):{};var t=this;var r=e.success;var i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){if(e.wait||t.isNew())i();if(r)r(t,n,e);if(!t.isNew())t.trigger("sync",t,n,e)};if(this.isNew()){e.success();return false}I(this,e);var s=this.sync("delete",this,e);if(!e.wait)i();return s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();if(this.isNew())return e;return e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:true}))},_validate:function(e,t){if(!t.validate||!this.validate)return true;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;if(!r)return true;this.trigger("invalid",this,r,n.extend(t,{validationError:r}));return false}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);t.unshift(this.attributes);return n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={});if(t.model)this.model=t.model;if(t.comparator!==void 0)this.comparator=t.comparator;this._reset();this.initialize.apply(this,arguments);if(e)this.reset(e,n.extend({silent:true},t))};var g={add:true,remove:true,merge:true};var y={add:true,remove:false};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:false},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e);t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id];delete this._byId[u.cid];o=this.indexOf(u);this.models.splice(o,1);this.length--;if(!t.silent){t.index=o;u.trigger("remove",u,this,t)}this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g);if(t.parse)e=this.parse(e,t);var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l;var c=t.at;var h=this.model;var p=this.comparator&&c==null&&t.sort!==false;var v=n.isString(this.comparator)?this.comparator:null;var m=[],y=[],b={};var w=t.add,E=t.merge,S=t.remove;var x=!p&&w&&S?[]:false;for(i=0,s=e.length;i<s;i++){a=e[i]||{};if(a instanceof d){o=u=a}else{o=a[h.prototype.idAttribute||"id"]}if(f=this.get(o)){if(S)b[f.cid]=true;if(E){a=a===u?u.attributes:a;if(t.parse)a=f.parse(a,t);f.set(a,t);if(p&&!l&&f.hasChanged(v))l=true}e[i]=f}else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u);this._addReference(u,t)}u=f||u;if(x&&(u.isNew()||!b[u.id]))x.push(u);b[u.id]=true}if(S){for(i=0,s=this.length;i<s;++i){if(!b[(u=this.models[i]).cid])y.push(u)}if(y.length)this.remove(y,t)}if(m.length||x&&x.length){if(p)l=true;this.length+=m.length;if(c!=null){for(i=0,s=m.length;i<s;i++){this.models.splice(c+i,0,m[i])}}else{if(x)this.models.length=0;var T=x||m;for(i=0,s=T.length;i<s;i++){this.models.push(T[i])}}}if(l)this.sort({silent:true});if(!t.silent){for(i=0,s=m.length;i<s;i++){(u=m[i]).trigger("add",u,this,t)}if(l||x&&x.length)this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++){this._removeReference(this.models[r],t)}t.previousModels=this.models;this._reset();e=this.add(e,n.extend({silent:true},t));if(!t.silent)this.trigger("reset",this,t);return e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);this.remove(t,e);return t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);this.remove(t,e);return t},slice:function(){return u.apply(this.models,arguments)},get:function(e){if(e==null)return void 0;return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){if(n.isEmpty(e))return t?void 0:[];return this[t?"find":"filter"](function(t){for(var n in e){if(e[n]!==t.get(n))return false}return true})},findWhere:function(e){return this.where(e,true)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");e||(e={});if(n.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(n.bind(this.comparator,this))}if(!e.silent)this.trigger("sort",this,e);return this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{};if(e.parse===void 0)e.parse=true;var t=e.success;var r=this;e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e);if(t)t(r,n,e);r.trigger("sync",r,n,e)};I(this,e);return this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return false;if(!t.wait)this.add(e,t);var r=this;var i=t.success;t.success=function(e,n){if(t.wait)r.add(e,t);if(i)i(e,n,t)};e.save(null,t);return e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{};t.collection=this;var r=new this.model(e,t);if(!r.validationError)return r;this.trigger("invalid",this,r.validationError,t);return false},_addReference:function(e,t){this._byId[e.cid]=e;if(e.id!=null)this._byId[e.id]=e;if(!e.collection)e.collection=this;e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){if(this===e.collection)delete e.collection;e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;if(e==="destroy")this.remove(t,r);if(t&&e==="change:"+t.idAttribute){delete this._byId[t.previous(t.idAttribute)];if(t.id!=null)this._byId[t.id]=t}this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);t.unshift(this.models);return n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view");e||(e={});n.extend(this,n.pick(e,x));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var S=/^(\S+)\s*(.*)$/;var x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(e,n){if(this.$el)this.undelegateEvents();this.$el=e instanceof t.$?e:t.$(e);this.el=this.$el[0];if(n!==false)this.delegateEvents();return this},delegateEvents:function(e){if(!(e||(e=n.result(this,"events"))))return this;this.undelegateEvents();for(var t in e){var r=e[t];if(!n.isFunction(r))r=this[e[t]];if(!r)continue;var i=t.match(S);var s=i[1],o=i[2];r=n.bind(r,this);s+=".delegateEvents"+this.cid;if(o===""){this.$el.on(s,r)}else{this.$el.on(s,o,r)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));if(this.id)e.id=n.result(this,"id");if(this.className)e["class"]=n.result(this,"className");var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,false)}else{this.setElement(n.result(this,"el"),false)}}});t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(!i.url){o.url=n.result(r,"url")||F()}if(i.data==null&&r&&(e==="create"||e==="update"||e==="patch")){o.contentType="application/json";o.data=JSON.stringify(i.attrs||r.toJSON(i))}if(i.emulateJSON){o.contentType="application/x-www-form-urlencoded";o.data=o.data?{model:o.data}:{}}if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST";if(i.emulateJSON)o.data._method=s;var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}if(o.type!=="GET"&&!i.emulateJSON){o.processData=false}if(o.type==="PATCH"&&T){o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var a=i.xhr=t.ajax(n.extend(o,i));r.trigger("request",r,a,i);return a};var T=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={});if(e.routes)this.routes=e.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var k=/\((.*?)\)/g;var L=/(\(\?)?:\w+/g;var A=/\*\w+/g;var O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){if(!n.isRegExp(e))e=this._routeToRegExp(e);if(n.isFunction(r)){i=r;r=""}if(!i)i=this[r];var s=this;t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o);s.trigger.apply(s,["route:"+r].concat(o));s.trigger("route",r,o);t.history.trigger("route",s,r,o)});return this},execute:function(e,t){if(e)e.apply(this,t)},navigate:function(e,n){t.history.navigate(e,n);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null){this.route(e,this.routes[e])}},_routeToRegExp:function(e){e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)");return new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){if(t===r.length-1)return e||null;return e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[];n.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var _=/^[#\/]|\s+$/g;var D=/^\/+|\/+$/g;var P=/msie [\w.]+/;var H=/\/$/;var B=/#.*$/;M.started=false;n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null){if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");if(!e.indexOf(n))e=e.slice(n.length)}else{e=this.getHash()}}return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=true;this.options=n.extend({root:"/"},this.options,e);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment();var i=document.documentMode;var s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow;this.navigate(r)}if(this._hasPushState){t.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!s){t.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else if(this._hasPushState&&this.atRoot()&&u.hash){this.fragment=this.getHash().replace(_,"");this.history.replaceState({},document.title,this.root+this.fragment)}}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);M.started=false},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe){t=this.getFragment(this.getHash(this.iframe))}if(t===this.fragment)return false;if(this.iframe)this.navigate(t);this.loadUrl()},loadUrl:function(e){e=this.fragment=this.getFragment(e);return n.any(this.handlers,function(t){if(t.route.test(e)){t.callback(e);return true}})},navigate:function(e,t){if(!M.started)return false;if(!t||t===true)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e;if(e===""&&n!=="/")n=n.slice(0,-1);if(this._hasPushState){this.history[t.replace?"replaceState":"pushState"]({},document.title,n)}else if(this._wantsHashChange){this._updateHash(this.location,e,t.replace);if(this.iframe&&e!==this.getFragment(this.getHash(this.iframe))){if(!t.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,e,t.replace)}}else{return this.location.assign(n)}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else{e.hash="#"+t}}});t.history=new M;var j=function(e,t){var r=this;var i;if(e&&n.has(e,"constructor")){i=e.constructor}else{i=function(){return r.apply(this,arguments)}}n.extend(i,r,t);var s=function(){this.constructor=i};s.prototype=r.prototype;i.prototype=new s;if(e)n.extend(i.prototype,e);i.__super__=r.prototype;return i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')};var I=function(e,t){var n=t.error;t.error=function(r){if(n)n(e,r,t);e.trigger("error",e,r,t)}};return t});var Keystone=Keystone||{};Keystone.Utils=Keystone.Utils||{};(function(e,t){"use strict";var n=e(window);var r=e(document);var i=window.screen||{};var s=document.body;var o={SCREEN_XS:480,SCREEN_SM:768,SCREEN_MD:992,SCREEN_LG:1200};var u=function(e,t){return e>t};var a=function(e,t){return e<t};var f;if(typeof s.offsetHeight!=="undefined"){f="offsetHeight"}else if(typeof s.clientHeight!=="undefined"){f="clientHeight"}else{f="scrollHeight"}var l=typeof window.innerHeight!=="undefined"?"innerHeight":"clientHeight";var c=window.scrollY!=="undefined"?function(){return window.scrollY}:function(){return document.documentElement.scrollTop};Keystone.Utils.ScreenUtil={getWinWidth:function(){return n.width()},getWinHeight:function(){return n.height()},getDocWidth:function(){return r.width()},getDocHeight:function(){return r.height()},getScreen:function(){return i},getConstant:function(e){return o[e]},getWinScrollTop:c,getElemHeight:function(e){return e[f]},getViewportHeight:function(){return window[l]},isScreenBottom:function(){return window.innerHeight+this.getWinScrollTop()>=this.getElemHeight(s)},isExtraSmall:function(){return this.getWinWidth()<=o.SCREEN_XS},isSmall:function(){var e=this.getWinWidth();return e>=o.SCREEN_SM&&e<o.SCREEN_MD},isMedium:function(){var e=this.getWinWidth();return e>=o.SCREEN_MD&&e<o.SCREEN_LG},isLarge:function(){return this.getWinWidth()>=o.SCREEN_LG},isGreater:function(e){return u(this.getWinWidth(),this.getConstant(e))},isGreaterEq:function(e){return u(this.getWinWidth()+1,this.getConstant(e))},isLess:function(e){return a(this.getWinWidth(),this.getConstant(e))},isLessEq:function(e){return a(this.getWinWidth()+1,this.getConstant(e))},isElemOnScreen:function(t,r,i){var s=t instanceof jQuery?t:e(t);if(r===null||typeof r==="undefined"){r=1}if(i===null||typeof i==="undefined"){i=1}var o={top:n.scrollTop(),left:n.scrollLeft()};o.right=o.left+n.width();o.bottom=o.top+n.height();var u=s.outerHeight();var a=s.outerWidth();if(!a||!u){return false}var f=s.offset();f.right=f.left+a;f.bottom=f.top+u;var l=!(o.right<f.left||o.left>f.right||o.bottom<f.top||o.top>f.bottom);if(!l){return false}var c={top:Math.min(1,(f.bottom-o.top)/u),bottom:Math.min(1,(o.bottom-f.top)/u),left:Math.min(1,(f.right-o.left)/a),right:Math.min(1,(o.right-f.left)/a)};return c.left*c.right>r&&c.top*c.bottom>i},isElemPartiallyOnScreen:function(e){var t=e.getBoundingClientRect();var r={top:n.scrollTop(),left:n.scrollLeft()};r.right=r.left+n.width();r.bottom=r.top+n.height();var i=t.left>=r.left||t.right<=r.right;var s=t.top<=r.top||t.bottom>=r.bottom;return i||s}}})(jQuery);window.Keystone=Keystone||{};Keystone.Utils=Keystone.Utils||{};(function(e){"use strict";var t={RESPONSIVE_IMAGE_CSS_CLASS:"img-responsive"};var n=function(e,t){if(e.className.indexOf(t)===-1){e.className+=" "+t}};Keystone.Utils.ResponsiveUtil={makeImagesResponsive:function(e){var r=t.RESPONSIVE_IMAGE_CSS_CLASS;for(var i=0,s=e.length;i<s;i+=1){n(e[i],r)}},getConstant:function(e){return t[e]}}})();(function(e,t,n,r,i){"use strict";n.Keystone=n.Keystone||{};n.Keystone.Utils=n.Keystone.Utils||{};var s={OB_TEXT_WIDGET_ID:Keystone.Cfg.outbrainTextWidgetId,OB_IMAGES_WIDGET_ID:"AR_5",OB_IMAGES_MOBILE_WIDGET_ID:Keystone.Cfg.outbrainImagesMobileWidgetId,OB_TEXT_INACTIVE_CLASS:"OB_TEXT_INACTIVE",OB_IMAGES_INACTIVE_CLASS:"OB_IMAGES_INACTIVE",FULL_OBJECT_NAME:"Kesytone.Utils.PromoUnitUtil"};Keystone.Utils.PromoUnitUtil={injectOutbrain:function(e){var t=function(){var t=r.createElement("div");var n=e.container||r.getElementById(e.containerId);if(!n){throw new Error(s.FULL_OBJECT_NAME+".injectOutbrain(): Please provide either a valid DOM element for the container, "+"or a valid DOM element ID for the containerId.");return}t.className="OUTBRAIN";t.setAttribute("data-src",Keystone.Cfg.siteUrl+e.url);t.setAttribute("data-widget-id",e.widgetId);t.setAttribute("data-ob-template",Keystone.Cfg.siteUrl);n.innerHTML="";n.appendChild(t);try{OBR.extern.researchWidget()}catch(i){}};if(typeof OBR!=="undefined"){t()}else{setTimeout(t)}},pushPlacements:function(n){console.log("PUSH PLACEMENTS");var r=n instanceof e?n:e(n);var i=r.find(".placement-para").get();var s=r.find(".placement-fixed").get();var o={fixed:s,para:i};t.push({TSPlacementDivs:o,event:"evt-tst-page-load"})},pushPlacementsByArticle:function(n){var r=e("#article-body-"+n);var i=r.find(".placement-para").get();var s=r.find(".placement-fixed").get();var o={fixed:s,para:i};t.push({TSPlacementDivs:o,event:"evt-tst-placements-load"})},getConstant:function(e){return s[e]}}})(jQuery,dataLayer,window,document);var Keystone=Keystone||{};Keystone.Utils=Keystone.Utils||{};(function(e,t){"use strict";var n=function(){(function(e,t){if(t._ym===void 0){t._ym="";var n=e.createElement("script");n.type="text/javascript",n.async=!0,n.src="//static.yieldmo.com/ym.m4.js",(e.getElementsByTagName("head")[0]||e.getElementsByTagName("body")[0]).appendChild(n)}else t._ym instanceof String||void 0===t._ym.chkPls||t._ym.chkPls()})(document,window)};Keystone.Utils.YieldMoUtil={injectYieldMo:function(t){var n=new $.Deferred;if(!e.desktop()){var r=document.createElement("div");r.className="ym ym_scroll";r.setAttribute("data-id",t);if(e.mobile()){r.id=Keystone.Cfg.yieldMoMobileId}else if(e.tablet()){r.id=Keystone.Cfg.yieldMoTabletId}n.resolve({yieldMoDiv:r,yieldMoScriptFn:this.yieldMoScriptFn})}return n.promise()},yieldMoScriptFn:n}})(device);var Keystone=Keystone||{};Keystone.Utils=Keystone.Utils||{};(function(e,t,n){"use strict";var r=function(t){var n=e.createElement("div");n.id=t;return n};var i=function(e){return function(){try{t._mNHandle.queue.push(function(){t._mNDetails.loadTag(e,"800x200","778919155")})}catch(n){}}};Keystone.Utils.MedianetUtil={createUnit:function(e){var t=new $.Deferred;if(typeof e==="number"){e=e.toString()}if(typeof e==="string"){if(e.substr(0,9)!=="medianet-"){e="medianet-"+e}var n=r(e);this.executeMedianet=i(e);t.resolve({medianetDiv:n,executeMedianet:this.executeMedianet})}else{t.fail()}return t.promise()},refreshUnit:function(n){if(!(t.location.href.indexOf("nomedianet")>-1)){var r=$("#promo-div-article-bottom");t._TSTmnet=t._TSTmnet||0;var i=Math.floor(Math.random()*1e10).toString();var s,o,u,a,f,l,c,h;if(r){h={enterprise:{desktop:"228977480",tablet:"132319536",size:"610x690",cid:"8CUY7WC2U"},slideshow:{desktop:"451639587",tablet:"826746491",size:"610x690",cid:"8CUY7WC2U"},video:{desktop:"774578787",tablet:"774578787",size:"620x250",cid:"8CU18CJ62"}};if(n==="slideshow")o="slideshow";else if(t.location.pathname.match(/^\/video/i))o="video";else o="enterprise";s=h[o];u=e.createElement("div");a=typeof TSTiPromo!=="undefined"&&TSTiPromo.device.tablet()?"tablet":"desktop";u.id=i;r.empty();r.append(u);if(!t._TSTmnet){console.log("APPLYING SCRIPT");t._mNHandle=t._mNHandle||{};t._mNHandle.queue=t._mNHandle.queue||[];t.medianet_versionId="121199";f=e.createElement("script");l=e.getElementsByTagName("script")[0];c="https:"===e.location.protocol;f.type="text/javascript";f.src=(c?"https:":"http:")+"//contextual.media.net/dmedianet.js?cid="+s.cid+(c?"&https=1":"")+"";f.async="async";l.parentNode.insertBefore(f,l)}try{t._TSTmnet+=1;t._mNHandle.queue.push(function(){t._mNDetails.loadTag(u.id,s.size,s[a])})}catch(p){console.log(p)}}}}}})(document,window);(function(e){"use strict";e.slideTo=function(t,n){var r=null;if(typeof t!=="undefined"){if(typeof t==="number"){r=t}else if(typeof t==="string"){var i=parseInt(t,10);if(!isNaN(i)){r=i}else if(e(t).length!==0){r=e(t).offset().top}}else if(typeof t.nodeType!=="undefined"&&t.nodeType===Node.ELEMENT_NODE){r=e(t).offset().top}else if(t instanceof jQuery){r=t.offset().top}}if(r!==null){var s=n||600;return e("body,html").animate({scrollTop:r},s).promise()}}})(jQuery);var Keystone=Keystone||{};Keystone.Mixins=Keystone.Mixins||{};(function(e){"use strict";var t=e(window);Keystone.Mixins.ElementVisibility={isViewElemMostlyVisible:function(){return this.isOnScreen(0,0)},isOnScreen:function(e,n){var r=this.$el;if(e===null||typeof e==="undefined"){e=1}if(n===null||typeof n==="undefined"){n=1}var i=t;var s={top:i.scrollTop(),left:i.scrollLeft()};s.right=s.left+i.width();s.bottom=s.top+i.height();var o=r.outerHeight();var u=r.outerWidth();if(!u||!o){return false}var a=r.offset();a.right=a.left+u;a.bottom=a.top+o;var f=!(s.right<a.left||s.left>a.right||s.bottom<a.top||s.top>a.bottom);if(!f){return false}var l={top:Math.min(1,(a.bottom-s.top)/o),bottom:Math.min(1,(s.bottom-a.top)/o),left:Math.min(1,(a.right-s.left)/u),right:Math.min(1,(s.right-a.left)/u)};return l.left*l.right>e&&l.top*l.bottom>n}}})(jQuery);var Keystone=Keystone||{};Keystone.Mixins=Keystone.Mixins||{};(function(e,t){"use strict";var n=e(window);Keystone.Mixins.ArticleShare={}})(jQuery,Keystone.Utils.DisqusUtil);var Keystone=Keystone||{};Keystone.Models=Keystone.Models||{};(function(){"use strict";Keystone.Models.ArticleSidebar=Backbone.Model.extend({initialize:function(e,t){this.parentModel=t&&t.parentModel||{}},defaults:{},validate:function(e,t){},parse:function(e,t){return e}})})();var Keystone=Keystone||{};Keystone.Models=Keystone.Models||{};(function(){"use strict";Keystone.Models.ArticlePage=Backbone.Model.extend({body:"",number:null,pageTitle:"",isFirstPage:false,isLastPage:false,initialize:function(e,t){this.parentModel=t.parentModel||{}},defaults:{},validate:function(e,t){},parse:function(e,t){return e}})})();var Keystone=Keystone||{};Keystone.Models=Keystone.Models||{};(function(e){"use strict";Keystone.Models.Article=Backbone.Model.extend({idAttribute:"id",defaults:{id:null,headline:"",headlineFacebook:"",headlineTwitter:"",callout:"",url:"",authors:[],authorId:null,authorUrl:"",authorName:"",publishDate:"",siteName:"",siteCode:"",subcategoryId:"",subcategoryName:"",contentType:"",categoryName:"",categoryId:"",subcategorySlug:"",categoryPath:"",primaryTag:"",channels:[],tags:[],keyword:[],smallThumbUrl:"",mediumThumbUrl:"",largeThumbUrl:"",isBrandedView:"",isExternalContributor:"",articleImageUrl:"",articleImageCaption:"",numPages:0,pages:[],leadTicker:[],publishDateFormatted:""},initialize:function(){},validate:function(e,t){},parse:function(e,t){if(e){if(e.authors){try{e.authors=JSON.parse(e.authors)}catch(n){}}if(e.tags){try{e.tags=JSON.parse(e.tags)}catch(n){}}if(e.leadTicker){try{e.leadTicker=JSON.parse(e.leadTicker)}catch(n){}}}return e}})})(Keystone.Models.ArticlePage);var Keystone=Keystone||{};Keystone.Models=Keystone.Models||{};(function(){"use strict";Keystone.Models.Slideshow=Backbone.Model.extend({idAttribute:"storyId",defaults:{storyId:null,headline:"",callout:"",url:"",authorId:null,authorUrl:"",authorName:"",publishDate:new Date,publishDateAsString:"",subCategoryName:"",categoryPath:"",keyword:[],numSlides:0,slides:[]},initialize:function(){},validate:function(e,t){},parse:function(e,t){return e}})})();var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e,t){"use strict";Keystone.Views.BaseStory=Backbone.View.extend({subViews:[],subModelClass:"Article",subViewClass:"Article",events:{},toggleComments:function(){this[this.isCommentsOpen()?"closeComments":"openComments"]()},goToComments:function(){e.slideTo(this.$articleComments);this.openComments()},closeComments:function(){t.$disqusThreadElem.hide();this.$articleComments.removeClass("is-open").text("Show Comments");return this},openComments:function(){this.parentView.closeAllComments();if(this.model.get("storyId")===t.getIdentifier()){t.$disqusThreadElem.show()}else{var e={identifier:this.model.get("storyId"),url:this.model.get("url"),title:this.model.get("headline")};var n=t.loadDisqus(e);n.done(_.bind(function(){this.$articleComments.after(t.$disqusThreadElem.show())},this))}this.$articleComments.addClass("is-open").text("Hide Comments");return this},isCommentsOpen:function(){return this.$articleComments.hasClass("is-open")},initShareLinks:function(){var e=this.model.get("headline");var t=Keystone.Cfg.siteUrl+this.model.get("url");this.$(".article-share-menu .share").ShareLink({title:e,text:e,url:t,via:Keystone.Cfg.twitterHandle||"",width:460,height:350})},createSubViews:function(e){var t=document.createDocumentFragment();var n=this.model.toJSON();_.each(e,function(e,r){pageModelData.parentArticle=n;var i=new this.subModelClass(e,{parentModel:this.model});var s=new this.subViewClass({model:i,parentView:this});t.appendChild(s.render().el);this.subViews.push(s)},this);return t}})})(jQuery,Keystone.Utils.DisqusUtil);var Keystone=Keystone||{};Keystone.Collections=Keystone.Collections||{};(function(e,t){"use strict";Keystone.Collections.ArticleList=Backbone.Collection.extend({model:function(n,r){if(n.slides&&n.slides.length>0){return new t(n,r)}else{return new e(n,r)}},pagination:{currentArticleUrl:"",currentArticleDataUrl:"",nextArticleUrl:"",nextArticleDataUrl:""},initPagination:function(e){this.pagination=e},parse:function(e){this.initPagination(e.article.pagination);var t=[_.isObject(e.article)&&e.article||{}];return t},url:function(){return this.pagination.nextArticleDataUrl}})})(Keystone.Models.Article,Keystone.Models.Slideshow);var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e,t,n){"use strict";Keystone.Views.ArticleSidebar=Backbone.View.extend({tagName:"div",className:"article-sidebar-content",events:{},initialize:function(e){if(e){this.parentView=e.parentView||{};this.parentPageView=e.parentPageView||{}}this.subViews=[]},render:function(){return this},getTrendingStories:function(){return this.get("trendingStories")}})})(jQuery,Keystone.Models.ArticlePage,Keystone.Views.ArticlePage);var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e,t,n,r,i,s,o,u,a){"use strict";var f=o.getElementById("article-page-template");if(!f){throw new Error('Keystone.Views.ArticlePage: DOM element w/id="article-page-template" does not exist.')}Keystone.Views.ArticlePage=Backbone.View.extend({tagName:"div",className:"article__page",template:Handlebars.compile(e(f).html()),events:{},initialize:function(e){this.parentView=e.parentView||{};this.$pageEnd=this.$(".page-end")},render:function(){var e=this.model.toJSON();if(this.isLastPage()){e=t.extend({},e,{id:this.parentView.model.get("id"),footer:this.parentView.model.get("footer")})}this.$el.html(this.template(e));return this},isFirstPage:function(){return this.model.get("isFirstPage")},isLastPage:function(){return this.model.get("isLastPage")},isViewElemMostlyVisible:function(){return s.isElemOnScreen(this.$el,0,0)}})})(jQuery,_,Keystone.Models.ArticleSidebar,Keystone.Views.ArticleSidebar,device,Keystone.Utils.ScreenUtil,document,window);var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e,t){"use strict";Keystone.Views.PaginatedArticlePage=Backbone.View.extend({template:Handlebars.compile(e("#article-page-template").html()),events:{},initialize:function(e){this.parentView=e.parentView||{}},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},isFirstPage:function(){return this.model.get("isFirstPage")},isLastPage:function(){return this.model.get("isLastPage")}})})(jQuery);var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e){"use strict";Keystone.Views.PaginatedArticleTop=Backbone.View.extend({template:Handlebars.compile($("#article-top-template").html()),events:{},initialize:function(e){this.parentView=e.parentView||{};this.app=e.app},render:function(){var e=_.pick(this.model.toJSON(),["smallThumbUrl","mediumThumbUrl","largeThumbUrl","articleImageCaption","isFirstPage","videoStoryId","headline"]);var t=_.extend({},e,this.app.getSelectedPageView().model.toJSON());this.$el.html(this.template(t));return this}})})();var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e){"use strict";Keystone.Views.PaginatedArticleFooter=Backbone.View.extend({template:Handlebars.compile("{{{footer}}}"),events:{},initialize:function(e){this.parentView=e.parentView||{};this.app=e.app},render:function(){if(this.app.isLastPageViewSelected()){var e=_.pick(this.model.toJSON(),["footer"]);this.$el.html(this.template(e))}return this}})})();var Keystone=Keystone||{};Keystone.Views=Keystone.Views||{};(function(e,t,n,r,i,s,o){"use strict";Keystone.Views.ArticleList=Backbone.View.extend({className:"",events:{},initialize:function(e){this.app=e.app;this.collection=this.app.articleList;this.dispatcher=this.app.dispatcher;this.articleViews=[];this.listenTo(this.collection,"add",this.addOne);t.bindAll(this,["showLoader","hideLoader"]);this.createLoader()},render:function(){this.addAll();return this},addOne:function(e){var t=new n({model:e,parentView:this,isCreatePageViews:true});this.$el.append(t.render().el);this.articleViews.push(t)},addAll:function(){this.collection.each(this.addOne,this)},getMostlyVisibleArticleView:function(){var e=this.articleViews[0];var t;for(var n=0,r=this.articleViews.length;n<r;n+=1){if(this.articleViews[n].isViewElemMostlyVisible()){t=this.articleViews[n+1];if(typeof t!=="undefined"&&t.isViewElemMostlyVisible()){e=t}else{e=this.articleViews[n]}break}}return e},getMostlyVisiblePageView:function(){var e=this.getMostlyVisibleArticleView();return e.getMostlyVisiblePageView()},getMostlyVisibleArticleUrl:function(){return this.getMostlyVisibleArticleView().model.get("url")},getMostlyVisiblePageUrl:function(){return this.getMostlyVisiblePageView().model.get("url")},getArticleViewByIndex:function(e){return this.articleViews[e]},getArticlePageViewByIndex:function(e,t){t=t||0;return this.articleViews[t].pageViews[e]},getFirstArticleView:function(){return this.articleViews[0]},getLastArticleView:function(){return this.articleViews[this.articleViews.length-1]},createLoader:function(){var t=s.createElement("div");t.className="article-page-loader";this.$pageLoader=e(t)},showLoader:function(){this.$el.append(this.$pageLoader.show())},hideLoader:function(){this.$pageLoader.hide()},closeAllComments:function(){for(var e=0,t=this.articleViews.length;e<t;e+=1){this.articleViews[e].closeComments()}},addArticleViews:function(e){this.articleViews=this.articleViews.concat(t.isArray(e)?e:[e])}})})(jQuery,_,Keystone.Views.Article,Keystone.Models.ArticlePage,Keystone.Views.ArticlePage,document,window);var Keystone=Keystone||{};Keystone.Utils=Keystone.Utils||{};(function(e){"use strict";var t={MAX_SCROLL_THROTTLE:400,MAX_SCROLL_DEBOUNCE:300};var n={scrollThrottle:400,scrollDebounce:300};var r;var i;var s;var o=false;var u=0;var a={navPrev:false,navNext:true};Keystone.ArticleNavigation={handleWinScroll:function(){if(!s.is(":animated")){var e=r.scrollTop();if(e>u){a.navPrev=false;a.navNext=true}else{a.navPrev=true;a.navNext=false}u=e;this.dispatcher.trigger("uinavigate:pagenav",a)}},init:function(t){if(o){return}_.bindAll(this,"handleWinScroll");o=true;r=e(window);i=e(document);s=e(document.body);this.dispatcher=t.dispatcher||s;var u=_.extend({},n,t);r.on("scroll",_.throttle(this.handleWinScroll,u.scrollThrottle))},getConstant:function(e){return t[e]}};var f=Keystone.AdUtil;Keystone.Utils.ArticleAdUtil={attachAds:function(e){},init:function(t){this.dispatcher=t.dispatcher||e(document.body)}}})(jQuery);window.Keystone=window.Keystone||{};(function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=true;Keystone.MobilePostProcess={init:function(n){t.bindAll(this,["postPageChange","postArticleLoad"]);this.app=n.app;this.dispatcher=this.app.dispatcher;this.dispatcher.on("uinavigate:loadnext",this.postArticleLoad);this._callMobileFollowStatusAjax();f.addEventListener("scroll",t.throttle(function(){var t=e("#share-widget").isOnScreen();if(!t&&e("#social-links-wrap.slideout").length<1){Keystone.MobilePostProcess.setSlideOutSocial()}},1e3))},postPageChange:function(){},setSlideOutSocial:function(){var t=e("#social-links-wrap"),n=e("body");if(e("#mobile_social_slideout").length<1){t.addClass("slideout").prepend('<div id="mobile_social_slideout" class="social-bar-slideout-tab"></div><div id="social-bar-slideout-close" class="social-bar-slideout-close"></div><div class="social-bar-slideout-title">Share this Article</div>');t.on("click","#mobile_social_slideout",function(){t.css("right",0);n.addClass("no-scroll")});t.on("click","#social-bar-slideout-close",function(){t.css("right","-100%");n.removeClass("no-scroll")})}},postArticleLoad:function(){if(!c){this._updatePageTitle();this.fireAnalytics(1);this._firePageEvent()}else{c=false}this._updateAuthorFollowLinks();this._setSocialLinks();this._makeMediaResponsive();this._pushPlacementsByArticle()},_setSocialLinks:function(){var e=this.app;var t=e.$shareLinks;if(t.length!==0){var r=e.getArticleModel();var i=r.get("headline");var s=n.msBaseUrl+r.get("url");t.ShareLink({title:i,text:i,facebookTitle:r.get("headlineFacebook"),twitterText:r.get("headlineTwitter"),url:s,image:r.get("articleImageUrl"),via:n.siteName||"",width:460,height:350})}},initShareLinks:function(){var t=this.app;var r=t.$shareLinks;if(r.length!==0){var i=this.mostlyVisiblePageView.model.parentModel;var s=i.get("headline");var o=n.msBaseUrl+i.get("url");r.ShareLink({title:s,text:s,facebookTitle:i.get("headlineFacebook"),twitterText:i.get("headlineTwtter"),url:o,image:i.get("articleImageUrl"),via:n.siteName||"",width:460,height:350});e("#back-top").addClass("back-top--mobile-share")}},fireAnalytics:function(e){var t=this.mostlyVisiblePageView.model.parentModel;var n=Keystone.Cfg.siteUrl+t.get("url");Keystone.pageMetaData={pageName:n,articleId:t.get("id"),articleName:t.get("headline"),authors:[],category:t.get("subcategoryName"),section:t.get("categoryName"),site:t.get("siteCode"),keywords:[],pagination:e+" of 1",tickers:[],page:1,pubDate:"",pubTime:"",contentType:t.get("contentType"),embeddedVideo:t.get("videoStoryId")}},_makeMediaResponsive:function(){if(typeof this.app.getLastArticleView==="function"){s.makeImagesResponsive(this.app.getLastArticleView().$(".article__content img").get());this.app.getLastArticleView().$(".article__body").find("iframe").filter(function(){return this.src.indexOf("/s.t.st/embed/")!==-1}).wrap('<div class="embed-responsive embed-responsive-16by9 embed-responsive-article"></div>').addClass("embed-responsive-item article-media")}},_pushPlacements:function(){},_pushPlacementsByArticle:function(){if(this.app.articleList){var e=this.app.articleList.models[0].get("id");i.pushPlacementsByArticle(e)}},_updateAuthorFollowLinks:function(){if(Keystone.UPM&&Keystone.UPM.TSFollowLinks){Keystone.UPM.TSFollowLinks.updateFollowLinks()}},_firePageEvent:function(){e(a.body).trigger("pageLoad",Keystone)},_callMobileFollowStatusAjax:function(){if(Keystone.UPM&&Keystone.UPM.TSFollowLinks){Keystone.UPM.TSFollowLinks.mobileFollowStatusAjax()}},_updatePageTitle:function(){a.title=this.mostlyVisiblePageView.model.get("pageTitle")}}})(jQuery,_,Keystone.Cfg,Keystone.AdUtil,Keystone.Utils.PromoUnitUtil,Keystone.Utils.ResponsiveUtil,Keystone.UpmUtil,dataLayer,document,window);window.Keystone=window.Keystone||{};(function(e,t,n,r,i,s,o,u,a,f){"use strict";var l=true;Keystone.DesktopPostProcess={init:function(e){t.bindAll(this,["postPageChange"]);this.app=e.app;this.dispatcher=this.app.dispatcher;this.dispatcher.on("uinavigate:changepage",this.postPageChange);this.initSubscriptionBox()},postPageChange:function(){var e=Keystone.articleModelData.article.contentType==="Slideshow";if(!l){if(!e){this.scrollToTop();this.updatePageTitle();this.refreshAds();this._fireOnPageLoad()}this._makeMediaResponsive()}else{l=false;this._makeMediaResponsive();if(!e){this.initShareLinks();this._fireOnPageLoad()}}},refreshAds:function(){var t=u.getElementsByClassName("googleAd");if(t.length>0){r.refreshAds(e.makeArray(t))}},updatePageTitle:function(){u.title=this.app.getSelectedPageModel().get("pageTitle")},paginationSlider:function(){var t=this.app;if(t.getSelectedPageView().isLastPage()){e("#next-page-arrow").addClass("article__arrow-next--hidden")}else{var n=t.$(".article__arrow-next");var r=t.$(".article__page").first();var i=r.width()-n.width()|0;var s=r.height()/2-n.height()/2|0;n.css({top:s});n.removeClass("article__arrow-next--hidden")}},createOutbrain:function(){},initSubscriptionBox:function(){var n=this.app;var r=n.$(".subscription-module");var i=n.$(".article__body").length>0?n.$(".article__body").offset().top:0;var s=e(a);var o=t(function(){if(s.scrollTop()>=i){r.removeClass("subscription-module--hidden")}}).bind(this).throttle(400).value();e("#close-subscription").on("click",function(){r.find(".subscription-module__input-wrap").removeClass("subscription-module__input-wrap--open")});e(".subscription-module__text-wrap").on("click",function(){r.find(".subscription-module__input-wrap").addClass("subscription-module__input-wrap--open")});s.on("keyup",function(e){if(e.which===27){r.find(".subscription-module__input-wrap").removeClass("subscription-module__input-wrap--open")}})},initShareLinks:function(){var e=this.app;var t=e.$shareLinks;if(t.length!==0){var r=e.getArticleModel();var i=r.get("headline");var s=n.msBaseUrl+r.get("url");t.ShareLink({title:i,text:i,facebookTitle:r.get("headlineFacebook"),twitterText:r.get("headlineTwitter"),url:s,image:r.get("articleImageUrl"),via:n.siteName||"",width:460,height:350})}},scrollToTop:function(){a.scrollTo(0,0)},_pushPlacements:function(){var e=this.app.getSelectedPageView().$el;i.pushPlacements(e)},_makeMediaResponsive:function(){o.makeImagesResponsive(this.app.getSelectedPageView().$(".article__body img").get());this.app.getSelectedPageView().$(".article__body").find("iframe").filter(function(){return this.src.indexOf("/s.t.st/embed/")!==-1}).wrap('<div class="embed-responsive embed-responsive-16by9 embed-responsive-article"></div>').addClass("embed-responsive-item article-media")},_fireOnPageLoad:function(){console.log("PAGE LOAD");this._pushPlacements()}}})(jQuery,_,Keystone.Cfg,Keystone.AdUtil,Keystone.Utils.PromoUnitUtil,Keystone.Utils.StickyAdUtil,Keystone.Utils.ResponsiveUtil,document,window);window.Keystone=window.Keystone||{};(function(e,t,n,r,i,s,o,u,a){"use strict";var f=true;var l=e(o.body);Keystone.ArticleAppPostProcess={init:function(e){t.bindAll(this,["postPageChange"]);this.app=e.app;this.dispatcher=this.app.dispatcher;this.dispatcher.on("uinavigate:changepage",this.postPageChange);if(n.mobile()){i.init(e)}else{s.init(e)}this.dispatcher.trigger("uinavigate:loadnext")},postPageChange:function(){if(!f){this.fireAnalytics();l.trigger("pageLoad",Keystone)}else{this.fireAnalytics();f=false}},postArticleLoad:function(){},fireAnalytics:function(){var e=this.app.getSelectedArticleModel();var t=this.app.getSelectedPageModel();var n=r.siteUrl+t.get("url");var i=e.get("leadTicker")&&Array.isArray(e.get("leadTicker"))?e.get("leadTicker").join(" "):null;var s=moment(e.get("publishDate"));var o;try{var u=30-s.minute()%30;var o=moment(s).add("minutes",u).format("h:mm:00 a")}catch(a){}Keystone.pageMetaData={pageName:n,articleId:e.id,articleName:e.get("headline"),authors:e.get("authors"),category:e.get("subcategoryName"),section:e.get("categoryName"),site:e.get("siteCode"),keywords:null,pagination:t.get("number")+" of "+e.get("numPages"),tickers:i,pubDate:e.get("publishDateFormatted"),pubTime:o,contentType:e.get("contentType"),embeddedVideo:e.get("videoStoryId")}}}})(jQuery,_,device,Keystone.Cfg,Keystone.MobilePostProcess,Keystone.DesktopPostProcess,document,window);(function(e,t,n){"use strict";var r="/json/stories/author/";window.Keystone=Keystone||{};Keystone.AuthorUtil={loadLatestStories:function(t){var n=e.ajax({url:r+t,dataType:"json",data:{type:"json"}});return n}}})(jQuery,_);var Keystone=Keystone||{};Keystone.Routers=Keystone.Routers||{};(function(e,t,n,r,i,s){"use strict";if(!t.isFunction(history.replaceState)){Backbone.history.start=function(){}}Keystone.Routers.Article=Backbone.Router.extend({routes:{},initialize:function(e){this.app=e.app;this.dispatcher=this.app.dispatcher;this.articleList=this.app.articleList;this.articleListView=this.app.articleListView;var t=n.articleAppMappings;if(!Array.isArray(t)||t.length===0){throw new Error("Keystone.Routers.Article: articleAppMappings are not defined in the global configuration")}var r=t.length;while(r--){this.route(t[r],"showPage")}},start:function(){Backbone.history.start({pushState:true})},showPage:function(e,t,n){this.dispatcher.trigger("uinavigate:changepage",{storyId:e,pageNum:t,uriName:n})},goToPage:function(t){t=parseInt(t,10);if(!isNaN(t)&&t>0){var n=t-1;e.slideTo(this.articleListView.getArticlePageViewByIndex(n).el)}}})})(jQuery,_,Keystone.Cfg,document,window);(function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";var v=t.bind(h.getElementById,h);var m=v("article-main");var g=v("article-app");var y=false;if(!g||!Keystone.articleModelData||!Keystone.articleModelData.article){return}var b=37;var w=39;var E="article__pagination-link--numeric";var S="article__pagination-link--active";var x="article__pagination-link--disabled";var T="article__pagination-link--next";var N=true;p.Keystone=Keystone||{};Keystone.articleApp=new(Backbone.View.extend({events:{"click #page-num":"navigatePage","click #prev-page":"clickPrev","click #read-more-button":"clickNext","click #next-page":"clickNext","click #close-author-popup":"closeAuthorPopup","click #to-top":"goToTop","click #view-comments":"goToComments","click .article-print-btn":"printArticle"},pageIndicatorTemplate:Handlebars.compile("{{currentPageNum}} of {{numPages}}"),footerTemplate:Handlebars.compile("{{{footer}}}"),initialize:function(){t.bindAll(this,["handleKeyControls","_updateActivePaginationItem","render"]);this.dispatcher=t.clone(Backbone.Events);this.router=new f({app:this});this.model=new n(Keystone.articleModelData.article,{parse:true});this.articlePages=t.map(this.model.get("pages"),function(e){return new r(e,{parentModel:this.article})},this);this._createInitialViews();this.$pagination=e(v("article-pagination"));this.$prevLink=e(v("prev-page"));this.$nextLink=e(v("next-page"));this.$authorPopup=e(v("author-popup"));this.$pageIndicator=e(v("page-indicator"));this.$shareWidget=e(v("share-widget"));this.$shareLinks=this.$shareWidget.find(".share");this.numPages=this.articlePages.length;this.dispatcher.on("uinavigate:changepage",this.render);e(p).on("keyup",this.handleKeyControls);l.init({app:this});this.initShareLinks()},start:function(){this.router.start()},render:function(e){e=e||{};if(!isNaN(e.pageNum)){var t=parseInt(e.pageNum,10)}else{var t=1}t=!isNaN(t)?t:1;if(t>0&&t<=this.pageViews.length){this.selectedPageView=this.pageViews[t-1];this._renderArticleRegions(e);this._updateActivePaginationItem()}},clickPrev:function(e){e.preventDefault();this.navigatePrevPage()},clickNext:function(e){e.preventDefault();this.navigateNextPage()},handleKeyControls:function(e){if(e.which===b){this.navigatePrevPage()}else if(e.which===w){this.navigateNextPage()}},navigatePrevPage:function(){var e=this.getPrevPageUrl();if(e){this.router.navigate(e,{trigger:true})}},navigateNextPage:function(){var e=this.getNextPageUrl();if(e){this.router.navigate(e,{trigger:true})}},goToTop:function(t){t.preventDefault();e.slideTo(0)},goToComments:function(t){t.preventDefault();e.slideTo(this.$articleComments)},printArticle:function(){var t=this.getSelectedPageViewNumber(),n=[],r=[],i="div.article__print-before > div.article__body-print",s="div.article__print-after > div.article__body-print";if(this.numPages===1){console.log("PRINTING SINGLE PAGE")}else{if(t===1){console.log("PRINTING MULTIPLE PAGES AT START");for(var o=t;o<this.numPages;o++){r.push(this.articlePages[o].get("body"))}}else if(t===this.numPages){console.log("PRINTING MULTIPLE PAGES AT END");for(var o=0;o<t-1;o++){n.push(this.articlePages[o].get("body"))}}else{console.log("PRINTING MULTIPLE PAGES IN BETWEEN");for(var o=0;o<t-1;o++){n.push(this.articlePages[o].get("body"))}for(var o=t;o<this.numPages;o++){r.push(this.articlePages[o].get("body"))}}e(i).html(n.join(""));e(s).html(r.join(""))}setTimeout(function(){p.print()},500)},openAuthorPopup:function(){return false},closeAuthorPopup:function(){this.$authorPopup.addClass("author--hidden")},getSelectedPageView:function(){return this.selectedPageView},getSelectedPageModel:function(){return this.selectedPageView.model},getSelectedPageViewUrl:function(){return this.getSelectedPageModel().get("url")},getSelectedPageViewNumber:function(){return this.getSelectedPageModel().get("number")},getSelectedArticleView:function(){return this},getSelectedArticleModel:function(){return this.model},getPageView:function(e){if(t.isNumber(e)&&e>=0&&e<this.numPages){return this.pageViews[e]}},getPageViewUrl:function(e){var t=this.getPageView(e);return t?t.model.get("url"):null},getPrevPageUrl:function(){var e=this.getSelectedPageViewNumber();return e>1?this.getPageViewUrl(e-2):null},getNextPageUrl:function(){var e=this.getSelectedPageViewNumber();return e<this.numPages?this.getPageViewUrl(e):null},isFirstPageViewSelected:function(){return this.getSelectedPageViewNumber()===1},isLastPageViewSelected:function(){return this.getSelectedPageViewNumber()===this.numPages},getArticleModel:function(){return this.model},_createInitialViews:function(){this.pageViews=this.articlePageViews=t.map(this.articlePages,function(e){return new s({el:this.$(".article__page")[0],model:e,parentView:this})},this);this.articleTopView=new o({el:this.$(".article__top")[0],model:this.model,parentView:this,app:this});this.articleFooterView=new a({el:this.$(".article__footer")[0],model:this.model,parentView:this,app:this})},initShareLinks:function(){if(this.$shareLinks.length!==0){var e=Keystone.articleModelData.article.headline;var t=Keystone.Cfg.msBaseUrl+Keystone.articleModelData.article.url;this.$shareLinks.unbind("click").ShareLink({title:e,text:e,facebookTitle:Keystone.articleModelData.article.headlineFacebook,twitterText:Keystone.articleModelData.article.headlineTwitter,url:t,image:Keystone.articleModelData.article.articleImageUrl,via:Keystone.Cfg.siteName||"",width:460,height:350})}},_updateActivePaginationItem:function(){var e=this.getSelectedPageViewNumber();var t=this.isFirstPageViewSelected();var n=this.isLastPageViewSelected();if(t){this.$prevLink.addClass("article__pagination-link--prev-disabled")}else{this.$prevLink.removeClass("article__pagination-link--prev-disabled")}if(n){this.$nextLink.addClass("article__pagination-link--next-disabled")}else{this.$nextLink.removeClass("article__pagination-link--next-disabled")}},_renderArticleRegions:function(t){var n={};var r=t.pageNum;var i=e("#video-container");if(!N){if(!this.articleTopView.model.attributes.videoStoryId){this.articleTopView.render()}if(this.getSelectedPageViewNumber()!==1){e("#video-container").addClass("video-container--no-placeholder")}this.getSelectedPageView().render();this.articleFooterView.render()}else{N=false}var s={currentPageNum:this.getSelectedPageViewNumber(),numPages:this.numPages};this.$pageIndicator.html(this.pageIndicatorTemplate(s))}}))({el:g});Keystone.articleApp.start()})(jQuery,_,Keystone.Models.Article,Keystone.Models.ArticlePage,Keystone.Views.PaginatedArticle,Keystone.Views.PaginatedArticlePage,Keystone.Views.PaginatedArticleTop,Keystone.Views.PaginatedArticleBottom,Keystone.Views.PaginatedArticleFooter,Keystone.Routers.Article,Keystone.ArticleAppPostProcess,Keystone.AuthorUtil,document,window)